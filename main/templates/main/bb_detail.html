{% extends 'layout/basic.html' %}
{% block title %}{{ bb.title }} - {{ bb.rubric.name }}{% endblock %}

{% block content %}
<div class="text m-2">
    <a href="{% url 'main:rubric_bbs' pk=bb.rubric.pk %}{{ all }}" class="btn btn-outline-dark">
        ← Назад к объявлениям
    </a>
</div>

<div class="container mt-4">
    <!-- Галерея изображений -->
    {% if bb.image or ais %}
    <div id="bbCarousel" class="carousel slide mb-4" data-bs-ride="carousel">
        <div class="carousel-inner text-center">

            {% if bb.image %}
            <div class="carousel-item active">
                <img src="{{ bb.image.url }}" class="d-block mx-auto img-fluid rounded" alt="{{ bb.title }}"
                     style="max-height: 200px; object-fit: contain; cursor: pointer;"
                     data-bs-toggle="modal" data-bs-target="#imageModal" data-img="{{ bb.image.url }}">
            </div>
            {% endif %}

            {% for ai in ais %}
            <div class="carousel-item {% if not bb.image and forloop.first %}active{% endif %}">
                <img src="{{ ai.image.url }}" class="d-block mx-auto img-fluid rounded"
                     style="max-height: 200px; object-fit: contain; cursor: pointer;"
                     data-bs-toggle="modal" data-bs-target="#imageModal" data-img="{{ ai.image.url }}">
            </div>
            {% endfor %}
        </div>

        <!-- Навигация -->
    <button class="carousel-control-prev" type="button" data-bs-target="#bbCarousel" data-bs-slide="prev">
      <span class="bg-dark rounded-circle d-flex align-items-center justify-content-center p-2" aria-hidden="true" style="width:40px; height:40px;">
        <span class="carousel-control-prev-icon"></span>
      </span>
      <span class="visually-hidden">Предыдущее</span>
    </button>

    <button class="carousel-control-next" type="button" data-bs-target="#bbCarousel" data-bs-slide="next">
      <span class="bg-dark rounded-circle d-flex align-items-center justify-content-center p-2" aria-hidden="true" style="width:40px; height:40px;">
        <span class="carousel-control-next-icon"></span>
      </span>
      <span class="visually-hidden">Следующее</span>
    </button>
    </div>
    {% endif %}

    <!-- Заголовок и описание -->
    <div class="row mb-4">
        <div class="col-md-12 mx-auto">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h2 class="card-title">{{ bb.title }}</h2>
                    <p class="card-text">{{ bb.content }}</p>
                    <p class="fw-bold fs-5">{{ bb.price }} руб.</p>
                    <p>{{ bb.contacts }}</p>
                    <p class="text-end text-muted fst-italic mb-0">Добавлено {{ bb.created_at }}</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Модальное окно для увеличения фото -->
<div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content bg-dark">
      <div class="modal-body text-center p-0">
        <img src="" id="modalImage" class="img-fluid rounded" alt="Фото объявления">
      </div>
    </div>
  </div>
</div>

<!-- JS для отображения фото в модалке -->
<script>
document.addEventListener('DOMContentLoaded', function () {
  const imageModal = document.getElementById('imageModal');
  imageModal.addEventListener('show.bs.modal', function (event) {
    const img = event.relatedTarget;
    const modalImg = imageModal.querySelector('#modalImage');
    modalImg.src = img.getAttribute('data-img');
  });
});
</script>

{% endblock %}
